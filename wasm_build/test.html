<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <div>
        <canvas width=600 height=600 id="canvas" style="float: left;"></canvas>
    </div>
    <div>
        <textarea id="scene" rows="1000" style="float: right;">
; A sample scene to be parsed by my hand-written parser

Sphere {
    0 -1 3   ; Coords <x y z>
    1        ; Radius
    255 0 0  ; Color <R G B>
}

Sphere {
    2 0 4
    1
    0 255 0
}

Sphere {
    -2 0 4
    1
    0 0 255
}

Sphere {
    0 -5001 0
    5000
    0 255 255
}

Light {
    0 0 0
    .2
    AMBIENT
}

Light {
    2 1 0
    .6
    POINT
}

Light {
    1 4 4
    .2
    DIRECTIONAL
}
    </textarea>

    </div>
    <div>
        
            <button id="go">Go</button>
            <p id="message"></p>
    </div>
    <script src="./test.js"> </script>
    <script>
        const width = 600;
        const height = 600;
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext('2d');

        function drawCanvasWTrace() {
            console.log("Drawing by calling trace from raytracer.")
            const imgData = ctx.createImageData(width, height);
            let i = 0;
            for (var y = height / 2; y > -height / 2; y--) {
                for (var x = -width / 2; x < width / 2; x++) {
                    const [r, g, b] = Module.trace(x, y);
                    imgData.data[i++] = r;
                    imgData.data[i++] = g;
                    imgData.data[i++] = b;
                    imgData.data[i++] = 255;
                }
            }
            ctx.putImageData(imgData, 0, 0);
        }

        function drawCanvasWVec() {
            console.log("Drawing by requesting a vector from raytracer.")
            const imgData = ctx.createImageData(width, height);
            const vec = Module.create_vec();
            const len = vec.size();
            for (let i = 0; i < len; i++) {
                imgData.data[i] = vec.get(i);
            }
            ctx.putImageData(imgData, 0, 0);
        }

        function drawCanvasWView() {
            console.log("Drawing by requesting a mem view to raytracer.")
            const imgData = ctx.createImageData(width, height);
            const vec = Module.create_view();
            for (let i = 0; i < vec.length; i++) {
                imgData.data[i] = vec[i];
            }
            ctx.putImageData(imgData, 0, 0);
        }
        function drawCanvasWViewStr(str) {
            console.log("Drawing by requesting a mem view to based on scene.")
            const imgData = ctx.createImageData(width, height);
            const vec = Module.create_view_from(str);
            console.log(vec);
            for (let i = 0; i < vec.length; i++) {
                imgData.data[i] = vec[i];
            }
            ctx.putImageData(imgData, 0, 0);
        }
        const text = document.getElementById('scene');
        document.getElementById("go").onclick = () => {
            drawCanvasWViewStr(text.value)
        }
        Module.onRuntimeInitialized = () => {
            const p = document.getElementById('message');
            const start = Date.now();
            drawCanvasWView();
            p.innerText = "Took " + (Date.now() - start) + " ms";
        }
    </script>
</body>

</html>